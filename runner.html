<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Markdown Table Formatter (Debug)</title>
  </head>
  <body>
    <pre id="output">Loading…</pre>

    <!-- 1) First log that runner.html loaded -->
    <script>
      console.log("🚀 runner.html loaded");
    </script>

    <!-- 2) Load your bundled formatter -->
    <script src="dist/table-formatter.js"></script>

    <!-- 3) Run the formatting, then copy to clipboard -->
    <script>
      console.log("🛠 formatTable is", window.formatTable);

      // Grab raw MD from ?md=
      const params = new URLSearchParams(location.search);
      const raw = decodeURIComponent(params.get("md") || "");
      console.log("📥 raw input:", raw);

      let formatted;
      try {
        formatted = window.formatTable(raw);
        console.log("📤 formatted output:", formatted);
      } catch (err) {
        console.error("❌ formatting error:", err);
        formatted = "Error: " + err.message;
      }

      // 🚀 Automatically copy to clipboard if supported
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard
          .writeText(formatted)
          .then(() => console.log("✅ Copied to clipboard"))
          .catch((err) => console.error("⚠️ Clipboard write failed:", err));
      } else {
        console.warn("📋 Clipboard API not available");
      }

      // If Shortcuts calls us, hand back via completion()
      if (typeof completion === "function") {
        completion(formatted);
      } else {
        // Otherwise show in the page
        const out = document.getElementById("output");
        out.style.whiteSpace = "pre";
        out.textContent = formatted;
      }
    </script>
  </body>
</html>
