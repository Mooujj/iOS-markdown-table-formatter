<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Markdown Table Formatter (Multiline Details Merge)</title>
  </head>
  <body>
    <pre id="output">Loadingâ€¦</pre>
    <script src="dist/table-formatter.js"></script>
    <script>
      // 1) grab raw MD
      const params = new URLSearchParams(location.search);
      let raw = decodeURIComponent(params.get("md") || "");

      // 2) deterministic merge of Details block
      const FIELD_KEYS = new Set([
        "Reminder Title:",
        "Details:",
        "Link:",
        "List:",
        "Tags:",
        "Due Date:",
        "Alerts:",
        "Location:",
        "Priority:",
        "Flagged:",
        "Completed:",
        "Date Completed:",
        "Parent Task:",
        "Includes Subtasks:",
        "Subtasks:",
        "Images:",
        "File Path:",
        "File Type:",
        "File Size:",
        "Date Created:",
        "Date Modified:",
      ]);

      // split into lines
      let lines = raw.split(/\r?\n/);

      // find the index of the Details row
      let idx = lines.findIndex((l) => /^\|\s*Details:\s*\|/.test(l));
      if (idx !== -1) {
        let mergedDetail = [];

        // look ahead to collect all lines to merge
        let i = idx + 1;
        for (; i < lines.length; i++) {
          // extract first cell
          let m = lines[i].match(/^\|\s*(.*?)\s*\|/);
          let key = m ? m[1].trim() : null;
          if (key && FIELD_KEYS.has(key)) {
            // hit the next real header â†’ stop merging
            break;
          }
          // otherwise itâ€™s a continuation line: grab its second cell
          let m2 = lines[i].match(/^\|\s*.*?\|\s*(.*?)(?:\||$)/);
          if (m2) {
            mergedDetail.push(m2[1].trim());
          }
        }

        if (mergedDetail.length) {
          // append to the original Details line
          // remove trailing '|' and whitespace
          lines[idx] =
            lines[idx].replace(/\|\s*$/, "") +
            "<br>" +
            mergedDetail.join("<br>") +
            " |";
          // remove the merged lines from the array
          lines.splice(idx + 1, mergedDetail.length);
        }
      }

      raw = lines.join("\n");
      console.log("ðŸ”„ normalized input:", raw);
    </script>
  </body>
</html>
