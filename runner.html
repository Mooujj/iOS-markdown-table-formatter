<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Markdown Table Formatter (Debug + Multiline Merge)</title>
  </head>
  <body>
    <pre id="output">Loadingâ€¦</pre>

    <script>
      console.log("ğŸš€ runner.html loaded");
    </script>

    <script src="dist/table-formatter.js"></script>

    <script>
      console.log("ğŸ›  formatTable is", window.formatTable);

      // 1) Grab raw MD from ?md=
      const params = new URLSearchParams(location.search);
      let raw = decodeURIComponent(params.get("md") || "");
      console.log("ğŸ“¥ raw input:", raw);

      // 2) Merge any rows where the first cell is empty into the previous row
      const lines = raw.split(/\r?\n/);
      const merged = [];
      for (let line of lines) {
        // match a simple two-column row: | first | second |
        const m = line.match(/^\|\s*(.*?)\s*\|\s*(.*?)\s*(\|.*)?$/);
        if (m && m[1] === "" && merged.length) {
          // this line's first cell is blank â†’ append its detail to last merged line
          // strip leading '|' and any trailing '|'
          const detail = m[2];
          // add a <br> for the line break
          merged[merged.length - 1] += "<br>" + detail;
        } else {
          merged.push(line);
        }
      }
      raw = merged.join("\n");
      console.log("ğŸ”„ normalized input:", raw);

      // 3) Format it
      let formatted;
      try {
        formatted = window.formatTable(raw);
        console.log("ğŸ“¤ formatted output:", formatted);
      } catch (err) {
        console.error("âŒ formatting error:", err);
        formatted = "Error: " + err.message;
      }

      // 4) Attempt auto-copy
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard
          .writeText(formatted)
          .then(() => console.log("âœ… Copied to clipboard"))
          .catch((err) => console.warn("âš ï¸ Clipboard write failed:", err));
      } else {
        console.warn("ğŸ“‹ Clipboard API not available");
      }

      // 5) Return to Shortcuts or show on screen
      if (typeof completion === "function") {
        completion(formatted);
      } else {
        const out = document.getElementById("output");
        out.style.whiteSpace = "pre";
        out.textContent = formatted;
      }
    </script>
  </body>
</html>
